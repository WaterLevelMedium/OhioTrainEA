<<!DOCTYPE html>
<html lang='en'>
<head>
	<base href="index.html" target="_blank">
	<meta charset=utf-8 />
	<title id="title">OhioTrainDerailmentEA</title>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no' />


<!-- Nice background-color from sonny rollins website : #3c3b4a -->
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!! START DEPRECIATED CDN LINKS !!!!!!!!!!!!!!!!!!!!!!! -->
<!-- REMOVED minimal jquery <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.slim.js" integrity="sha512-M3zrhxXOYQaeBJYLBv7DsKg2BWwSubf6htVyjSkjc9kPqx7Se98+q1oYyBJn2JZXzMaZvUkB8QzKAmeVfzj9ug==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
<!-- <script src="http://code.jquery.com/jquery-3.1.1.min.js"></script> -->
<!-- Old bootstrap, depreciated -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> -->
<!-- old  Jquery / dup leaflet / old chroma
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>   OLD CDN-->

<!-- OLD JQUERY <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>      <!-- updated 10/13/2022 --> -->
<!-- REMOVED MINIMAL JQUERY <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
<!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
	integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
	crossorigin=""></script> -->

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!! END DEPRECIATED CDN LINKS !!!!!!!!!!!!!!!!!!!!!!! -->

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!! START ACTIVE CDN LINKS !!!!!!!!!!!!!!!!!!!!!!! -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.css" />
<link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js" integrity="sha512-zInFF17qBFVvvvFpIfeBzo7Tj7+rQxLeTJDmbxjBz5/zIr89YVbTNelNhdTT+/DCrxoVzBeUPVFJsczKbB7sew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css" integrity="sha512-mD70nAW2ThLsWH0zif8JPbfraZ8hbCtjQ+5RU1m4+ztZq6/MymyZeB55pWsi4YAX+73yvcaJyk61mzfYMvtm9w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js" integrity="sha512-Dqm3h1Y4qiHUjbhxTuBGQsza0Tfppn53SHlu/uj1f+RT+xfShfe7r6czRf5r2NmllO2aKx+tYJgoxboOkn1Scg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- Leaflet Ajax must be below Leaflet source cdn  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
<!-- geoTiff Raster Layer handler for leaflet -->
<script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>

<!-- load markercluster  -->
<link rel="stylesheet" href="assets/css/markerCluster.css">
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster-src.js"></script>

 <!-- LOAD LOCAL STYLESHEET FOR LEGEND -->
 <link rel="stylesheet" href="assets/css/legend.css">
 <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!! END ACTIVE CDN LINKS !!!!!!!!!!!!!!!!!!!!!!! -->

<style>


  head {
    height: 0;
  }
	html {
		box-sizing: border-box;
    margin: 0px;
    padding 0;
    width: 100%;
    line-height:0;

	}
		body {
			margin: 0;
			padding: 0;
			background: #3c3b4a;
			font-family: "Noto Sans", sans-serif;
			color: #3d3d3d;
      line-height: 0;
		}

		#map {
			display: flex;
			/* //top: 0; */
			bottom: 0px;
			width: 100%;
      height: 100%;
      z-index: 900;
		}
		#showPoints {
			right: 8px;
		}
		#tables {
			right: 100px;

    }
		#tablesCollapse {
			z-index: 900;
		}
		.offcanvas-body {
			background: #bcd4e6;
		}
		.offcanvas-header {
			background: #12426a;
		}





</style>
</head>

<body>





      <!-- <div class='col'> -->
            <!-- DATA OFFCANVAS TRIGGER -->
            <!-- <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#dataOffCanvas" aria-controls="dataOffCanvas">
              <span class='navbar-toggler-icon'></span>
              <span class='navbar-text'><i>View the Data</i></span>
            </button>
        </div> -->

<nav class="navbar navbar-dark sticky-top" style="background-color: #602a11; padding:10 10 10 10">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">
			East Palestine, OH
			<hr class="divider">
			Train Derailment
		</a>
		<!-- LAYER OFFCANVAS TRIGGER -->
		<button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#layerOffCanvas" aria-controls="layerOffCanvas">
			<span class='navbar-toggler-icon'></span>
			<span class='navbar-text'>Layer Options</span>
		</button>
	</div>
</nav>

  <!-- END UPPER NAV BAR -->


 <!-- START OF DATA OFFCANVAS -->
<div class="offcanvas offcanvas-right" data-bs-scroll='true'data-bs-backdrop="false" tabindex="-1" id="dataOffCanvas" aria-labelledby="dataOffCanvas">

</div>

  <!-- END OF DATA OFFCANVAS -->

  <!-- START OF lAYER OFFCANVAS  -->
<div class="offcanvas offcanvas-bottom" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="layerOffCanvas" aria-labelledby="layerOffCanvas">
  <div class="offcanvas-header text-bg-dark" style="padding:10 10 10 10">
    <span class="navbar-toggler-icon"></span>
    <h5 class="offcanvas-title" id="offcanvasScrollingLabel">Layer Options</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>

  </div>



  <div class="offcanvas-body">
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col-1">Toggle Layer</th>
          <th scope="col-2">Opacity<th>
          <th scope="col-1">Toggle Legend</th>
        </tr>
      </thead>
      <tbody>
						<!-- START OF OFFCANVAS TABLE ROWS -->
					<tr>
						<th>
							<div class="form-check form-switch">
								<input class='form-check-input' onchange="toggleLayers(AirQualityPoints,AQP_clusters)" type='checkbox' role="switch" id="aqp_switch" checked>
							 </div>
						</th>

							<td>
								 <label class='form-check-label' for="aqp_switch">Air Quality Points</label>
							</td>
							<td>
								<input id="slide" type="range" min="0" max="1" step="0.01" value="1" onchange="updateLayerOpacity(AirQualityPoints, this.value)">
							</td>
							<td>
								<div class="form-check form-switch">
									<input class='form-check-input' onchange="toggleLegendItem(aqpLegend)" type='checkbox' role="switch" id="aqp_switch" checked>
								 </div>
							</td>
					</tr>



					<!-- TEMPLATE FOR LAYER ENTRY -->
		      <!--
		      <tr>
		        <th scope="row">

		        </th>
		        <td>

		        </td>
		        <td>

		        </td>
		      </tr>

		          -->
      </tbody>
    </table>
 	</div> <!-- END OF OFFCANVAS BODY  -->
</div>   <!-- END OF OFFCANVAS FULL-->


 <!-- this is all just for e.g. -->
						<!-- <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Primary Facility Layers</a>
							 <ul class="dropdown-menu">
								<div class="input-group mb-3">
										<div class="input-group-text">


											<input class="form-check-input mt-0 " type="checkbox" role="switch" value="" aria-label="Checkbox for following text input"  onchange="toggleLayer(primary_SSURGO_WGS84_floodFreqMax)">


											<strong style="padding: 10 10 10 10"> Flood Frequency - <i>Max Condition </i></strong>
											<!-- Opacity Slider -->
											<!-- <input id="slide" type="range" min="0" max="1" step="0.1" value="1" onchange="updateLayerOpacity(primary_SSURGO_WGS84_floodFreqMax, this.value)">
										</div>
								</div>
						</ul> -->











<div id='map'></div>



<script id="mainScript">


//!!!!!!!!!!!!!!!!!!!!!!!!!!!! SETUP !!!!!!!!!!!!!!!!!!!!!!!!!!!!

var options = {
	center: [40.832108, -80.52848],
	zoom: 15,
	closePopupOnClick: true,
};

 //extra commma before name because it aligns to the bad output
var map = L.map('map', options);


// PANES
// map.createPane('legend');
// map.createPane('baselayer');
//

// Esri Basemap has more zoom
var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
	// pane: 'baselayer',
}).addTo(map);
// var USGS_USImageryTopo = L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryTopo/MapServer/tile/{z}/{y}/{x}', {
// 	maxZoom: 20,
// 	attribution: 'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>'
// }).addTo(map);


// setup for leaflet geotiff
// var parse_georaster = require("georaster");

// var GeoRasterLayer = require("georaster-layer-for-leaflet");



/*
COLOR PALLET
1c66a6 - top banner , e39959 - inverted , cd071e - chinese red, bcd4e6 - beau blue , ffff99 - canary yellow , 9d8625 - compliment banner
*/

// START FABICON ICON SVG LINKS
const crossIcon = L.divIcon({
	html: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path fill="#FF0000" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/></svg>',
	iconSize: [30, 30],
	className: 'pendingMarker',
});
// const xIconBlue = L.divIcon({
// html: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path weight: 2px fill-opacity=".8" fill="#0000FF" d="M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"/></svg>',
// iconSize: [15, 12] ,
// className: 'xIconBlue',
// });

const xIconCanary = L.divIcon({
html: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path weight: 2px fill-opacity=".8" fill="#ffff99" d="M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"/></svg>',
iconSize: [15, 12] ,
// className: 'xIconBlue',
});



//!!!!!!!!!!!!!!!!!!!!HELPER FUNCTIONS!!!!!!!!!!!!!!!!!!!!!!!


// opacity slider functions
function updateOpacity(value) {
    var interactive_layer = L.LayerGroup().getLayers()[0]; //In case you are using layer group. Also if you define the Layer group as Global variable, then you can call getLayers() directly.
    if(interactive_layer!=undefined)
       interactive_layer.setOpacity(value);
};
function updateLayerOpacity(layer,value){
	layer.setStyle({fillOpacity: value});
	// value is usually just this.value
};


// onclick go to layer function
function goToLayer(layer){
	map.setZoom(14);
	try {
			map.flyTo(layer.getLatLng());
		} catch {
			map.flyToBounds(layer.getBounds());
		}
};

function googMapsLink(latlng){
  return "https://www.google.com/maps/place/" + latlng.toString().slice(7)
};

// toggle variable to use in togglePoints(); // CREDIT: Mapsam from  https://gist.github.com/mapsam/e66a8d12c23e4bedd0ed
window.toggle = false;
// Manual toggle layer function. only layer.toggle() and layer.togglePopup() and tooltip are leaflet supported
function toggleLayer(layer){
  if(!toggle){
    map.removeLayer(layer);
  } else {
    map.addLayer(layer)
  }
  toggle = !toggle;
};
function toggleLayers(layer,layer2){
  if(!toggle){
    map.removeLayer(layer);
		map.removeLayer(layer2);
  } else {
    map.addLayer(layer);
		map.addLayer(layer2);
  }
  toggle = !toggle;
};
function toggleLegendItem(layer){
	if(!toggle){
		layer.remove();
	} else {
		layer.addTo(map);
	}
	toggle = !toggle;
}




// aqp aqp_scaling
// 0-292,293-1000,1001-2805,2806-9091,9092-30303


// CHROMA COLOR SCALES
var whiteToBlue = chroma.scale(['white','blue']).colors(5);
var correctedReds = chroma.scale(['black','red','yellow','white']);




 // START LAYERS





 // Air Quality Points from src="https://www.epa.gov/oh/air-sampling-data-east-palestine-ohio-train-derailment"
 // help with markerClusters from: "https://gis.stackexchange.com/questions/362773/geojson-data-disappears-when-using-marker-cluster-plugin"
 // [2023-02-27] - working
 // PROPORTIONAL SCALING HANDLER FOR AQP
 function aqp_scaling(val){
 	if ((val > 0) && (val <= 292)){
 		// set interval & reset Value
 		val = 6
 	} else if ( val > 292 &&  val <=1000){ // ['292-1000', '1000-2805', '2805-9091', '9091-30303']
 		val = 8
 	} else if (val > 1000 && val <= 2805){
 		val = 10
 	} else if (val > 2805 && val <= 9091){
 		val = 12
 	} else if (val > 9091 && val <= 30303){
 		val = 14
 	} else {
 		val = 3
 	}
 	return val
 };



// Create list of dates for air quality sampling
 const dateList = ['020423','020523','020623','020723','020823','020923'];
 for(let step = 10; step<=21; step++){
	 dateList.push('02' + step + '23');
 };
 // air quality time scale handling
 function aqp_dateColorGradient(date){
	 let greenToRed = chroma.scale(['#00ff00','#ff0000']).colors(18);
	 let yellowToBlue = chroma.scale('YlGnBu').colors(18);
	 let color;
	 // iterate the list of dates to test with each points. assign color by key
	 // this for loop is the same as for i in enumerate(dateList): and returns a list pair
	 for(let [key, value] of Object.entries(dateList)){
		 if (date == value){
			 color = yellowToBlue[key]
		 }
		 // console.log(`${key}: ${value}`);
		 // console.log(key, date, value);
	 };
	 return color
 };

 // CREATE CLUSTER GROUP OF MARKER
var AQP_clusters = L.markerClusterGroup({
					spiderLegPolylineOptions: {
						weight: 0,
					},
					iconCreateFunction: function(cluster) {
							return L.divIcon({
								html: ' <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path  weight: 2px fill-opacity="1" fill="#7df9ff "  d="M418.4 157.9c35.3-8.3 61.6-40 61.6-77.9c0-44.2-35.8-80-80-80c-43.4 0-78.7 34.5-80 77.5L136.2 151.1C121.7 136.8 101.9 128 80 128c-44.2 0-80 35.8-80 80s35.8 80 80 80c12.2 0 23.8-2.7 34.1-7.6L259.7 407.8c-2.4 7.6-3.7 15.8-3.7 24.2c0 44.2 35.8 80 80 80s80-35.8 80-80c0-27.7-14-52.1-35.4-66.4l37.8-207.7zM156.3 232.2c2.2-6.9 3.5-14.2 3.7-21.7l183.8-73.5c3.6 3.5 7.4 6.7 11.6 9.5L317.6 354.1c-5.5 1.3-10.8 3.1-15.8 5.5L156.3 232.2z"/></svg><b style="color: #f00;background-color: #fff">' + cluster.getChildCount() + '</b>', // show number of sample chems in cluster
								iconSize: [40, 40] ,
								className: 'clusterIcon',
								// CLUSTER NODE ICON <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path weight: 2px fill-opacity="1" fill="#8a2be2"  d="M284.3 11.7c-15.6-15.6-40.9-15.6-56.6 0l-216 216c-15.6 15.6-15.6 40.9 0 56.6l216 216c15.6 15.6 40.9 15.6 56.6 0l216-216c15.6-15.6 15.6-40.9 0-56.6l-216-216z"/></svg><b style="color: #f00;background-color: #fff">
								// DIAMOND ICON <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path  weight: 2px fill-opacity="1" fill="#8a2be2"  d="M418.4 157.9c35.3-8.3 61.6-40 61.6-77.9c0-44.2-35.8-80-80-80c-43.4 0-78.7 34.5-80 77.5L136.2 151.1C121.7 136.8 101.9 128 80 128c-44.2 0-80 35.8-80 80s35.8 80 80 80c12.2 0 23.8-2.7 34.1-7.6L259.7 407.8c-2.4 7.6-3.7 15.8-3.7 24.2c0 44.2 35.8 80 80 80s80-35.8 80-80c0-27.7-14-52.1-35.4-66.4l37.8-207.7zM156.3 232.2c2.2-6.9 3.5-14.2 3.7-21.7l183.8-73.5c3.6 3.5 7.4 6.7 11.6 9.5L317.6 354.1c-5.5 1.3-10.8 3.1-15.8 5.5L156.3 232.2z"/></svg><b style="color: #f00;background-color: #fff">
							});
					},
					polygonOptions: {
						stroke: false,
						color: 'rgba(0,0,0,0)',
					},
	});
// ASSIGN INDIVIDUAL MARKERS AND ADD TO CLUSTER GROUP
var AirQualityPoints = new L.GeoJSON.AJAX('assets/AQP_Table.geojson',{
	 pointToLayer: function(feature, latlng){
		 var out = [];
		 var marker = L.circleMarker(latlng,{
			 radius: aqp_scaling(feature.properties.Results_Percentage),
			 weight: .1,
			 color: '#fff',
			 fillColor: aqp_dateColorGradient(feature.properties.Sample_ID.slice(-6)),
			 // fillColor: '#f00',
			 fillOpacity: 1,
		 });

		 if (feature.properties){
				for(key in feature.properties){
					if(key != 'Results_Percentage'){
						out.push(key+": "+feature.properties[key]);
					} else {
						out.push(key + ": "+feature.properties[key] + '%');
					};
				};
				marker.bindPopup(out.join("<br />"),{autoPan: false})
		 };
		 marker.addTo(AQP_clusters);
		 return marker;
	 },

}).addTo(map);
map.addLayer(AQP_clusters);


const yellowToBlue = chroma.scale('YlGnBu').colors(18);

// start aqplegend
 var aqpLegend = L.control({position: 'topleft', pane: 'aqpLegend'});
 aqpLegend.onAdd = function () {
		 var div = L.DomUtil.create('div', 'aqpLegend');
		 div.innerHTML += `
			 <div class="row">
			 	<div class="col">
					<b>Sample Date</b>
				</div>
			</div>
		 `;
		 for(let [key, value] of Object.entries(yellowToBlue)){
			 // let inner = ''background-color: '' + value + ''; opacity: 0.5'></i><p>Color</p>';
			 let formatDate = dateList[key].slice(0,2) + '/' + dateList[key].slice(2,4) + '/' + dateList[key].slice(4,6);
			 div.innerHTML += '<div class="row"><i style="background-color: ' + value + '; opacity: 1"><p>' + formatDate + '</p></i>';//<p>' + formatDate + '</p></div>';
		 };

		 let aqpCircleClasses =  ['292-1000', '1000-2805', '2805-9091', '9091-30303'];
		 let circleSizes = [6,8,10,12,14];
		 div.innerHTML += `
		 <hr class='divider'>
			 <div class="row">
				<div class="col">
					<b>% Beyond Reporting Limit</b>
				</div>
			</div>
		 `;
		 	div.innerHTML += "<div class='row'>"
		 	for(i in aqpCircleClasses){
				div.innerHTML += `
	 				<div class="row"><b><i class="circle" style="width: ` + (circleSizes[i] * 2 ) + `;height: ` + (circleSizes[i] * 2 ) +`;background:#289cc1"></i><p>` + aqpCircleClasses[i] + `%</p></b></div>
	 		 `;

			};
			div.innerHTML +="</div>";
			// Cluster Icon in legend
			div.innerHTML +=`
			<hr class='divider'>
				<div class="row">
					<div class="col-5"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path width=20px height=20px weight= 2px fill-opacity="1" fill="#7df9ff "  d="M418.4 157.9c35.3-8.3 61.6-40 61.6-77.9c0-44.2-35.8-80-80-80c-43.4 0-78.7 34.5-80 77.5L136.2 151.1C121.7 136.8 101.9 128 80 128c-44.2 0-80 35.8-80 80s35.8 80 80 80c12.2 0 23.8-2.7 34.1-7.6L259.7 407.8c-2.4 7.6-3.7 15.8-3.7 24.2c0 44.2 35.8 80 80 80s80-35.8 80-80c0-27.7-14-52.1-35.4-66.4l37.8-207.7zM156.3 232.2c2.2-6.9 3.5-14.2 3.7-21.7l183.8-73.5c3.6 3.5 7.4 6.7 11.6 9.5L317.6 354.1c-5.5 1.3-10.8 3.1-15.8 5.5L156.3 232.2z"/>Cluster</svg>
					</div> -
					<div class="col-2" id="smallFont">
						<b>Air Quality Cluster</b>
					</div>
			`;
		 // div.innerHTML += '</div>'
		 return div;
 };
 aqpLegend.addTo(map);
 // end aqplegend



 // PROPORTIONAL SCALING HANDLER FOR SQP
 function sqp_scaling(val){
 	if ((val > 0) && (val <= 6)){
 		// set interval & reset Value
 		val = 6
 	} else if ( val > 6 &&  val <=37){
 		val = 8
 	} else if (val > 37 && val <= 150){ // ['0-6','6-37','37-150','150-710','710-9,900'];
 		val = 10
 	} else if (val > 150 && val <= 710){
 		val = 12
 	} else if (val > 710 && val <= 9900){
 		val = 14
 	} else {
 		val = 3
 	}
 	return val
 };

 function sqp_dateColorGradient(date){
	 console.log(date);
	// let sqpDates = ['020423','020823','021023','021223','021423']
	let sqpDates = ['230208','230210'];
 	let yellowToBlue = chroma.scale('YlGnBu').colors(3);
 	let color;
 	// iterate the list of dates to test with each points. assign color by key
 	// this for loop is the same as for i in enumerate(dateList): and returns a list pair
 	for(let [key, value] of Object.entries(sqpDates)){
 		if (date == value){
 			color = yellowToBlue[key]
 		}
 		// console.log(`${key}: ${value}`);
 		// console.log(key, date, value);
 	};
 	return color
 };


 // CREATE CLUSTER GROUP OF MARKER
 // brown fill color 8b4513
var SQP_clusters = L.markerClusterGroup({
					spiderLegPolylineOptions: {
						weight: 0,
					},
					iconCreateFunction: function(cluster) {
							return L.divIcon({
								html:  '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path  weight: 2px fill-opacity="1" fill="#8b4513 "  d="M418.4 157.9c35.3-8.3 61.6-40 61.6-77.9c0-44.2-35.8-80-80-80c-43.4 0-78.7 34.5-80 77.5L136.2 151.1C121.7 136.8 101.9 128 80 128c-44.2 0-80 35.8-80 80s35.8 80 80 80c12.2 0 23.8-2.7 34.1-7.6L259.7 407.8c-2.4 7.6-3.7 15.8-3.7 24.2c0 44.2 35.8 80 80 80s80-35.8 80-80c0-27.7-14-52.1-35.4-66.4l37.8-207.7zM156.3 232.2c2.2-6.9 3.5-14.2 3.7-21.7l183.8-73.5c3.6 3.5 7.4 6.7 11.6 9.5L317.6 354.1c-5.5 1.3-10.8 3.1-15.8 5.5L156.3 232.2z"/></svg><b style="color: #f00;background-color: #fff">' + cluster.getChildCount() + '</b>',
								iconSize: [40, 40] ,
								className: 'clusterIcon',
							});
					},
					polygonOptions: {
						stroke: false,
						color: 'rgba(0,0,0,0)',
					},
	});

 var SoilQualityPoints = new L.GeoJSON.AJAX('assets/tables/SQP_Table.geojson',{
 	 pointToLayer: function(feature, latlng){
 		 var out = [];
 		 var marker = L.circleMarker(latlng,{
 			 radius: aqp_scaling(feature.properties.Results_Percentage),
 			 weight: .1,
 			 color: '#f00',
 			 fillColor: sqp_dateColorGradient(feature.properties.Samp_No.slice(-6)),
 			 // fillColor: '#f00',
 			 fillOpacity: 1,
 		 });

 		 if (feature.properties){
 				for(key in feature.properties){
 					if(key != 'Results_Percentage'){
 						out.push(key+": "+feature.properties[key]);
 					} else {
 						out.push(key + ": "+feature.properties[key] + '%');
 					};
 				};
 				marker.bindPopup(out.join("<br />"),{autoPan: false})
 		 };
 		 marker.addTo(SQP_clusters);
 		 return marker;
 	 },

 }).addTo(map);
 map.addLayer(SQP_clusters);

 // end points handling

// start soil ponits legend
 var sqpLegend = L.control({position: 'topleft', pane: 'sqpLegend'});
 sqpLegend.onAdd = function () {
	 	let yellowToBlue = chroma.scale('YlGnBu').colors(3);
		var div = L.DomUtil.create('div', 'sqpLegend');
		div.innerHTML += `
			<div class="row">
			 <div class="col">
				 <b>Sample Date</b>
			 </div>
		 </div>
		`;
		for(let [key, value] of Object.entries(yellowToBlue)){
			// let inner = ''background-color: '' + value + ''; opacity: 0.5'></i><p>Color</p>';
			let formatDate = dateList[key].slice(0,2) + '/' + dateList[key].slice(2,4) + '/' + dateList[key].slice(4,6);
			div.innerHTML += '<div class="row"><i style="background-color: ' + value + '; opacity: 1"><p>' + formatDate + '</p></i>';//<p>' + formatDate + '</p></div>';
		};

		let sqpCircleClasses = ['0-6','6-37','37-150','150-710','710-9,900'];
		let circleSizes = [6,8,10,12,14];
		div.innerHTML += `
		<hr class='divider'>
			<div class="row">
			 <div class="col">
				 <b>% Beyond Reporting Limit</b>
			 </div>
		 </div>
		`;
		 div.innerHTML += "<div class='row'>"
		 for(i in sqpCircleClasses){
			 div.innerHTML += `
				<div class="row"><b><i class="circle" style="width: ` + (circleSizes[i] * 2 ) + `;height: ` + (circleSizes[i] * 2 ) +`;background:#289cc1"></i><p>` + sqpCircleClasses[i] + `%</p></b></div>
			`;

		 };
		 div.innerHTML +="</div><hr class='divider'>";
		 // Cluster Icon in legend
		 div.innerHTML +=`
			 <div class="row">
				 <div class="col-5"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path width=20px height=20px weight= 2px fill-opacity="1" fill="#8b4513 "  d="M418.4 157.9c35.3-8.3 61.6-40 61.6-77.9c0-44.2-35.8-80-80-80c-43.4 0-78.7 34.5-80 77.5L136.2 151.1C121.7 136.8 101.9 128 80 128c-44.2 0-80 35.8-80 80s35.8 80 80 80c12.2 0 23.8-2.7 34.1-7.6L259.7 407.8c-2.4 7.6-3.7 15.8-3.7 24.2c0 44.2 35.8 80 80 80s80-35.8 80-80c0-27.7-14-52.1-35.4-66.4l37.8-207.7zM156.3 232.2c2.2-6.9 3.5-14.2 3.7-21.7l183.8-73.5c3.6 3.5 7.4 6.7 11.6 9.5L317.6 354.1c-5.5 1.3-10.8 3.1-15.8 5.5L156.3 232.2z"/>Cluster</svg>
				 </div> -
				 <div class="col-2" id="smallFont">
					 <b>Soil Quality Cluster</b>
				 </div>
		 `;
		// div.innerHTML += '</div>'
		return div;
 };
 sqpLegend.addTo(map);
 // end soil points legend

// RESERVED FOR ZINDEX ASSIGNMENT. DO NOT USE UNLESS BUGS OCCUR
// map.getPane('baselayer').style.zIndex = 750;
// map.getPane('legend').style.zIndex = 800;


// zoom to function for marker clusters
// AQP_clusters.on('clusterclick', function (a) {
// 	a.layer.zoomToBounds({padding: [200, 200]});
// });



	//
  // var disposalAreas =  new L.GeoJSON.AJAX('assets/polygons/rough_DisposalAreas_polygon[2023-02-14].geojson',{
  // 	onEachFeature: function popUp(feature, layer){
  // 			// show polygon group type
  // 				// popup with whole ssurgo table
  // 			 var out = [];
  // 			 if (feature.properties){
  // 					 for(key in feature.properties){
  // 							 out.push(key+": "+feature.properties[key]);
  // 					 }
  // 					 layer.bindPopup(out.join("<br />"),{autoPan: false});
  //            layer.bindTooltip('DA-' + feature.properties.ID,{direction: 'center',permanent: true, className: 'labels'});
	//
  //        };
  // 	 },
  //    fillColor: 'green',
  // 	fillOpacity: .4,
  // 	opacity:.2,
  // 	dashArray:'4',
	//
  // }).addTo(map);


	//
  // var APA_Subsections =  new L.GeoJSON.AJAX('assets/polygons/rough_APA_Subsections[2023-02-14].geojson',{
  // 	onEachFeature: function popUp(feature, layer){
  // 			// show polygon group type
  // 			// layer.bindTooltip(feature.properties.muname)
  // 				// popup with whole ssurgo table
  // 			 var out = [];
  // 			 if (feature.properties){
  // 					 for(key in feature.properties){
  // 							 out.push(key+": "+feature.properties[key]);
  // 					 }
  // 					 layer.bindPopup(out.join("<br />"),{autoPan: false});
  //            if(feature.properties.ID != 22){
  //              layer.bindTooltip('ID-' + feature.properties.ID,{direction: 'center',permanent: true, className: 'labels'});
  //            }
  //            else {
  //              layer.bindTooltip('Trench 22',{direction: 'center',permanent: true, className: 'labels'});
	//
  //            }
  //        };
  // 	 },
  //    fillColor: 'red',
  // 	fillOpacity: .4,
  // 	opacity:.2,
  // 	dashArray:'4',
	//
  // }).addTo(map);




		//
    // var ponds =  new L.GeoJSON.AJAX('assets/polygons/rough_ponds[2023-02-14].geojson',{
    // 	onEachFeature: function popUp(feature, layer){
    // 			// show polygon group type
    // 				// popup with whole ssurgo table
    // 			 var out = [];
    // 			 if (feature.properties){
    // 					 for(key in feature.properties){
    // 							 out.push(key+": "+feature.properties[key]);
    // 					 }
    // 					 layer.bindPopup(out.join("<br />"),{autoPan: false});
		//
    //        };
    // 	 },
    //    fillColor: '#10f',
    // 	fillOpacity: .2,
    // 	opacity:.2,
    // 	dashArray:'4',
		//
    // }).addTo(map);
		//
		//











// !!!!!!!!!!!!!!!!!! BEHAVIOR FUNCTIONS !!!!!!!!!!!!!!!!!!!!!!!!!!

// google maps link from lat lng !! Still adds a paraenthethese on the end but its fine







</script>

<script type=text/javascript id="extraScript">
</script>

</body>

</html>
